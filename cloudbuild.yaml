steps:
- name: 'gcr.io/cloud-builders/docker'
  args: ['build', '-t', '${_LOCATION}-docker.pkg.dev/${PROJECT_ID}/${_REPOSITORY}/${_IMAGE}:${BUILD_ID}', '.']

- name: 'gcr.io/cloud-builders/docker'
  args:
    ['push','${_LOCATION}-docker.pkg.dev/${PROJECT_ID}/${_REPOSITORY}/${_IMAGE}:${BUILD_ID}']

- name: "gcr.io/cloud-builders/gke-deploy"
  args:
  - run
  - --filename=gke-deploy.yml
  - --image=${_LOCATION}-docker.pkg.dev/${PROJECT_ID}/${_REPOSITORY}/${_IMAGE}:${BUILD_ID}
  - --location=us-central1-c
  - --cluster=gcp-devops
  - --namespace=gcp-devops-prod

substitutions:
  _LOCATION: 'us'        # Replace with your desired region
  _REPOSITORY: 'gcpdevops'          # Replace with your Artifact Registry repository name
  _IMAGE: 'gcpdevopssantosh'             # Replace with your image name
 # _IMAGE_FULL_PATH: 'us-docker.pkg.dev/${PROJECT_ID}/${_REPOSITORY}/${_IMAGE}:${BUILD_ID}'

options:
  dynamicSubstitutions: true


logsBucket: 'gs://gcpdevops-s'
serviceAccount: 'projects/ds-team-384807/serviceAccounts/gcp-devops@ds-team-384807.iam.gserviceaccount.com'
options:
  logging: GCS_ONLY